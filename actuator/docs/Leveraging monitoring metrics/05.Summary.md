# 정리
## Micrometer 사용법 이해
메트릭은 100% 정확한 숫자를 보는데 사용하는 것이 아니다. 약간의 오차를 감안하고 실시간으로 대략의 데이터를 보는 목적으로 사용한다.

<br>

### 마이크로미터 핵심 기능
Counter, Gauge, Timer, Tags

<br>

### MeterRegistry
마이크로미터 기능을 제공하는 핵심 컴포넌트<br>
스프링을 통해서 주입 받아서 사용하고, 이곳을 통해서 카운터, 게이지 등을 등록한다.

<br>

### Counter(카운터)
* https://prometheus.io/docs/concepts/metric_types/#counter
* 단조롭게 증가하는 단일 누적 측정항목 
  * 단일 값 
  * 보통 하나씩 증가 
  * 누적이므로 전체 값을 포함(total)
  * 프로메테우스에서는 일반적으로 카운터의 이름 마지막에 ```_total``` 을 붙여서 ```my_order_total``` 과 같이 표현함 
* 값을 증가하거나 0으로 초기화 하는 것만 가능 
* 마이크로미터에서 값을 감소하는 기능도 지원하지만, 목적에 맞지 않음 
* 예) HTTP 요청수 

<br>

### Gauge(게이지)
* https://prometheus.io/docs/concepts/metric_types/#gauge
* 게이지는 임의로 오르내릴 수 있는 단일 숫자 값을 나타내는 메트릭 
* 값의 현재 상태를 보는데 사용 
* 값이 증가하거나 감소할 수 있음 
* 예) 차량의 속도, CPU 사용량, 메모리 사용량

> 참고: 카운터와 게이지를 구분할 때는 값이 감소할 수 있는가를 고민해보면 도움이 된다.

<br>

### Timer
Timer는 좀 특별한 메트릭 측정 도구인데, 시간을 측정하는데 사용된다.
* 카운터와 유사한데, ```Timer``` 를 사용하면 실행 시간도 함께 측정할 수 있다.
* ```Timer``` 는 다음과 같은 내용을 한번에 측정해준다. 
  * ```seconds_count``` : 누적 실행 수 - ```카운터``` 
  * ```seconds_sum``` : 실행 시간의 합 - ```sum``` 
  * ```seconds_max``` : 최대 실행 시간(가장 오래걸린 실행 시간) - ```게이지``` 
    * 내부에 타임 윈도우라는 개념이 있어서 1~3분 마다 최대 실행 시간이 다시 계산된다. 
  * ```seconds_sum``` / ```seconds_count``` = 평균 실행시간

<br>

### Tag, 레이블
* Tag를 사용하면 데이터를 나누어서 확인할 수 있다. 
* Tag는 카디널리티가 낮으면서 그룹화 할 수 있는 단위에 사용해야 한다. 
  * 예) 성별, 주문 상태, 결제 수단(신용카드, 현금) 등등 
* 카디널리티가 높으면 안된다. 예) 주문번호, PK 같은 것